<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動與證書畫廊</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="site.webmanifest">
    <style>
        :root {
            --primary-color: #123458;
            --secondary-color: #030303;
            --accent-color: #D4C9BE;
            --light-color: #F1EFEC;
            --shadow: 0 8px 20px rgba(3,3,3,0.15);
            --radius: 14px;
        }
        * { box-sizing: border-box; }
        body { background: var(--accent-color); color: var(--secondary-color); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: var(--light-color); padding: 24px 20px; border-radius: 0 0 var(--radius) var(--radius); box-shadow: var(--shadow); }
        .title { margin: 0 0 6px 0; font-size: 26px; letter-spacing: 0.5px; }
        .subtitle { margin: 0; opacity: .9; }
        .toolbar { display: flex; gap: 10px; flex-wrap: wrap; margin: 18px 0; }
        .btn { border: 0; background: var(--primary-color); color: var(--light-color); padding: 8px 14px; border-radius: 24px; cursor: pointer; box-shadow: var(--shadow); transition: transform .15s ease, opacity .15s ease; }
        .btn.secondary { background: transparent; color: var(--primary-color); border: 1px solid var(--primary-color); }
        .btn:hover { transform: translateY(-1px); }
        .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
        .card { grid-column: span 4; background: var(--light-color); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); display: flex; flex-direction: column; }
        .thumb { position: relative; padding-top: 62%; background: #eae7e3; }
        .thumb img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
        .badge { position: absolute; top: 8px; left: 8px; background: rgba(18,52,88,.9); color: #fff; padding: 4px 8px; border-radius: 10px; font-size: 12px; }
        .content { padding: 12px 14px; display: flex; flex-direction: column; gap: 6px; }
        .name { font-size: 16px; font-weight: 600; color: var(--secondary-color); }
        .meta { font-size: 13px; color: #555; }
        .links { margin-top: 6px; display: flex; gap: 10px; }
        .link { text-decoration: none; color: var(--primary-color); font-weight: 600; }
        @media (max-width: 1024px) { .card{ grid-column: span 6; } }
        @media (max-width: 640px) { .card{ grid-column: span 12; } .title{ font-size:22px; } }

        /* 燈箱 */
        .lightbox { position: fixed; inset: 0; background: rgba(0,0,0,.7); display: none; align-items: center; justify-content: center; padding: 20px; }
        .lightbox.open { display: flex; }
        .lightbox img { max-width: 90vw; max-height: 85vh; border-radius: 10px; box-shadow: var(--shadow); background: #fff; }
    </style>
    <script>
        async function loadData() {
            const res = await fetch('data/profile.json');
            const data = await res.json();

            // 準備資料：照片（競賽 + 研討會）
            const photos = (data.competitionPhotos || []).map(p => ({
                type: 'photo',
                title: p.title_zh || p.title,
                date: p.date,
                image: p.image,
                source: p.competition || '活動'
            }));

            // 準備資料：證書（來自 competitions 的 certificate）
            const certs = (data.competitions || [])
                .filter(c => !!c.certificate)
                .map(c => ({
                    type: 'certificate',
                    title: (c.name_zh || c.name) + (c.achievement_zh ? ` - ${c.achievement_zh}` : ''),
                    date: c.date,
                    link: c.certificate,
                    preview: /\.(png|jpg|jpeg|webp)$/i.test(c.certificate) ? c.certificate : null,
                    source: c.organizer_zh || c.organizer
                }));

            return { photos, certs };
        }

        function render(items) {
            const grid = document.querySelector('.grid');
            grid.innerHTML = items.map(item => `
                <div class="card" data-type="${item.type}">
                    <div class="thumb">
                        ${item.type === 'photo' || item.preview ? `<img src="${item.preview || item.image}" alt="${item.title}"/>` : ''}
                        <div class="badge">${item.type === 'photo' ? '照片' : '證書'}</div>
                    </div>
                    <div class="content">
                        <div class="name">${item.title}</div>
                        <div class="meta">${item.date} · ${item.source || ''}</div>
                        <div class="links">
                            ${item.type === 'photo' ? `<a class="link view" href="#" data-img="${item.image}">放大查看</a>` : ''}
                            ${item.type === 'certificate' ? `<a class="link" href="${item.link}" target="_blank">開啟證書</a>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');

            // 綁定燈箱
            document.querySelectorAll('.link.view').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    const src = a.getAttribute('data-img');
                    openLightbox(src);
                });
            });
        }

        function openLightbox(src){
            const lb = document.querySelector('.lightbox');
            const img = lb.querySelector('img');
            img.src = src; lb.classList.add('open');
        }

        function initFilters(allItems){
            const showAll = () => render(allItems);
            const showType = (t) => render(allItems.filter(i => i.type === t));
            document.getElementById('filter-all').onclick = showAll;
            document.getElementById('filter-photos').onclick = () => showType('photo');
            document.getElementById('filter-certs').onclick = () => showType('certificate');
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const { photos, certs } = await loadData();
            const all = [...photos, ...certs];
            initFilters(all);
            render(all);

            document.querySelector('.lightbox').addEventListener('click', (e)=>{
                if(e.target.classList.contains('lightbox')){
                    e.currentTarget.classList.remove('open');
                }
            });
        });
    </script>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1 class="title">活動畫廊</h1>
            <p class="subtitle">競賽、研討會照片與證書一站式檢視</p>
            <div class="toolbar">
                <button class="btn" id="filter-all">全部</button>
                <button class="btn secondary" id="filter-photos">只看照片</button>
                <button class="btn secondary" id="filter-certs">只看證書</button>
                <a class="btn" href="profile.html">返回個人檔案</a>
            </div>
        </div>
    </div>

    <div class="container" style="margin-top:16px;">
        <div class="grid"></div>
    </div>

    <div class="lightbox"><img alt="預覽" src=""/></div>
</body>
</html>

